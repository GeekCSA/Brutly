//
// Created by moshe on 16/10/2023.
//

#pragma once

#ifndef UNTITLED_EXPLOITER_H
#define UNTITLED_EXPLOITER_H

#include <string>
#include <cstring>

#include "ShellCommander.h"
#include "../../Commons/Header/Exception.h"

class Exploiter {
public:

    //TODO: Add const word in the correct place
    virtual int run(size_t argc, const string argv[]) = 0;

    virtual char* fillCmdTemplate(const string& var1, const string& command) noexcept(false) final {

        size_t templateLen = command.length();
        size_t var1Len = var1.length();

        // Calculate the length of the final string
        int resultLen = templateLen - 3 + var1Len;  // Subtract 3 for "{0}"
        char* result = new char[resultLen + 1]; // +1 for the null terminator

        // Find and replace "{0}" with var1
        const char* pos = strstr(command, "{0}");
        if (pos != nullptr) {
            strncpy(result, command, pos - command);
            strcpy(result + (pos - command), var1);
            strcpy(result + (pos - command + var1Len), pos + 3); // Skip the "{0}"
        }else{
            throw invalidCommandException("The command template does not contain a temp-place in format of {0} for a variable value");
        }

        // Null-terminate the result
        result[resultLen] = '\0';

        return result;
    }
};

#endif //UNTITLED_EXPLOITER_H
